<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ffmpeg命令 | sooxie</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="blog">
    
    <link rel="preload" href="/blog/assets/css/0.styles.b6bfb1ac.css" as="style"><link rel="preload" href="/blog/assets/js/app.2b1dd648.js" as="script"><link rel="preload" href="/blog/assets/js/2.9d35f1e7.js" as="script"><link rel="preload" href="/blog/assets/js/25.c7b87c99.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.05c0c0f2.js"><link rel="prefetch" href="/blog/assets/js/11.80a46aca.js"><link rel="prefetch" href="/blog/assets/js/12.c3bb0779.js"><link rel="prefetch" href="/blog/assets/js/13.0ac6bf96.js"><link rel="prefetch" href="/blog/assets/js/14.4a902ab0.js"><link rel="prefetch" href="/blog/assets/js/15.e3b1de22.js"><link rel="prefetch" href="/blog/assets/js/16.a55bdbe8.js"><link rel="prefetch" href="/blog/assets/js/17.ccc303f1.js"><link rel="prefetch" href="/blog/assets/js/18.434a4e7e.js"><link rel="prefetch" href="/blog/assets/js/19.2c8625c2.js"><link rel="prefetch" href="/blog/assets/js/20.74d5efe1.js"><link rel="prefetch" href="/blog/assets/js/21.1935b90a.js"><link rel="prefetch" href="/blog/assets/js/22.922aaf91.js"><link rel="prefetch" href="/blog/assets/js/23.87709697.js"><link rel="prefetch" href="/blog/assets/js/24.1a78ec94.js"><link rel="prefetch" href="/blog/assets/js/26.b89ac752.js"><link rel="prefetch" href="/blog/assets/js/27.9fca9731.js"><link rel="prefetch" href="/blog/assets/js/28.d03624e3.js"><link rel="prefetch" href="/blog/assets/js/29.e6a8c56a.js"><link rel="prefetch" href="/blog/assets/js/3.c1504772.js"><link rel="prefetch" href="/blog/assets/js/30.ab747e65.js"><link rel="prefetch" href="/blog/assets/js/31.93caa551.js"><link rel="prefetch" href="/blog/assets/js/32.a33dfa2e.js"><link rel="prefetch" href="/blog/assets/js/33.116287a2.js"><link rel="prefetch" href="/blog/assets/js/34.7e9bef1c.js"><link rel="prefetch" href="/blog/assets/js/35.a2ec2d50.js"><link rel="prefetch" href="/blog/assets/js/36.2a0380a0.js"><link rel="prefetch" href="/blog/assets/js/37.26cec5ab.js"><link rel="prefetch" href="/blog/assets/js/38.3bfeb8c0.js"><link rel="prefetch" href="/blog/assets/js/39.26da52be.js"><link rel="prefetch" href="/blog/assets/js/4.bd52d1aa.js"><link rel="prefetch" href="/blog/assets/js/40.ce882dac.js"><link rel="prefetch" href="/blog/assets/js/41.c87b78f9.js"><link rel="prefetch" href="/blog/assets/js/42.53bf9ffc.js"><link rel="prefetch" href="/blog/assets/js/43.ed3e5bd5.js"><link rel="prefetch" href="/blog/assets/js/44.47c9d096.js"><link rel="prefetch" href="/blog/assets/js/45.ac18124c.js"><link rel="prefetch" href="/blog/assets/js/46.dd742084.js"><link rel="prefetch" href="/blog/assets/js/47.e7176f5d.js"><link rel="prefetch" href="/blog/assets/js/48.c3abcfe0.js"><link rel="prefetch" href="/blog/assets/js/49.5089961f.js"><link rel="prefetch" href="/blog/assets/js/5.ac3fab13.js"><link rel="prefetch" href="/blog/assets/js/50.d5d60fa4.js"><link rel="prefetch" href="/blog/assets/js/51.33229a8a.js"><link rel="prefetch" href="/blog/assets/js/52.fae1aa29.js"><link rel="prefetch" href="/blog/assets/js/53.0af5c4fe.js"><link rel="prefetch" href="/blog/assets/js/54.a57bd936.js"><link rel="prefetch" href="/blog/assets/js/55.9698e9d2.js"><link rel="prefetch" href="/blog/assets/js/56.578098ec.js"><link rel="prefetch" href="/blog/assets/js/57.b829bc2b.js"><link rel="prefetch" href="/blog/assets/js/58.b55e06c9.js"><link rel="prefetch" href="/blog/assets/js/59.da4a3e55.js"><link rel="prefetch" href="/blog/assets/js/6.16bd1611.js"><link rel="prefetch" href="/blog/assets/js/60.0210415a.js"><link rel="prefetch" href="/blog/assets/js/61.0a06d51b.js"><link rel="prefetch" href="/blog/assets/js/62.d43e2aa9.js"><link rel="prefetch" href="/blog/assets/js/63.324d4d98.js"><link rel="prefetch" href="/blog/assets/js/64.04ef7635.js"><link rel="prefetch" href="/blog/assets/js/65.6446e418.js"><link rel="prefetch" href="/blog/assets/js/66.8585aa25.js"><link rel="prefetch" href="/blog/assets/js/67.dfeaefd5.js"><link rel="prefetch" href="/blog/assets/js/68.924c834d.js"><link rel="prefetch" href="/blog/assets/js/69.abbce79f.js"><link rel="prefetch" href="/blog/assets/js/7.05726647.js"><link rel="prefetch" href="/blog/assets/js/70.ed425a23.js"><link rel="prefetch" href="/blog/assets/js/71.05125181.js"><link rel="prefetch" href="/blog/assets/js/72.7b1273f0.js"><link rel="prefetch" href="/blog/assets/js/73.7a1c2600.js"><link rel="prefetch" href="/blog/assets/js/74.bb73b474.js"><link rel="prefetch" href="/blog/assets/js/75.2407e93c.js"><link rel="prefetch" href="/blog/assets/js/76.299197e3.js"><link rel="prefetch" href="/blog/assets/js/77.9ec19bb4.js"><link rel="prefetch" href="/blog/assets/js/78.3bb869bc.js"><link rel="prefetch" href="/blog/assets/js/79.6f77bf35.js"><link rel="prefetch" href="/blog/assets/js/8.2d11f171.js"><link rel="prefetch" href="/blog/assets/js/80.02f43f83.js"><link rel="prefetch" href="/blog/assets/js/81.c0d9fa63.js"><link rel="prefetch" href="/blog/assets/js/82.b9491bae.js"><link rel="prefetch" href="/blog/assets/js/83.722b7b32.js"><link rel="prefetch" href="/blog/assets/js/84.93872ad4.js"><link rel="prefetch" href="/blog/assets/js/85.1f86f81d.js"><link rel="prefetch" href="/blog/assets/js/86.fc0605c4.js"><link rel="prefetch" href="/blog/assets/js/87.e1448029.js"><link rel="prefetch" href="/blog/assets/js/88.e53fcbb2.js"><link rel="prefetch" href="/blog/assets/js/89.8f6cfaa6.js"><link rel="prefetch" href="/blog/assets/js/9.798fb69f.js"><link rel="prefetch" href="/blog/assets/js/90.600e1df3.js"><link rel="prefetch" href="/blog/assets/js/91.c6ece35b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b6bfb1ac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">sooxie</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/ios/" class="nav-link">
  iOS
</a></div><div class="nav-item"><a href="/blog/web/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/blog/ffmpeg/" class="nav-link router-link-active">
  ffmpeg
</a></div><div class="nav-item"><a href="/blog/opengl/" class="nav-link">
  OpenGL
</a></div><div class="nav-item"><a href="/blog/computer/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
  Algorithm
</a></div><div class="nav-item"><a href="/blog/version/" class="nav-link">
  版本控制
</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link">
  面试
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/ios/" class="nav-link">
  iOS
</a></div><div class="nav-item"><a href="/blog/web/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/blog/ffmpeg/" class="nav-link router-link-active">
  ffmpeg
</a></div><div class="nav-item"><a href="/blog/opengl/" class="nav-link">
  OpenGL
</a></div><div class="nav-item"><a href="/blog/computer/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
  Algorithm
</a></div><div class="nav-item"><a href="/blog/version/" class="nav-link">
  版本控制
</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link">
  面试
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ffmpeg</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ffmpeg命令</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/ffmpeg/cmd/ffmpeg_cmd.html" aria-current="page" class="active sidebar-link">ffmpeg命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/ffmpeg/cmd/ffmpeg_cmd.html#命令基本格式及参数" class="sidebar-link">命令基本格式及参数</a></li><li class="sidebar-sub-header"><a href="/blog/ffmpeg/cmd/ffmpeg_cmd.html#主要参数" class="sidebar-link">主要参数</a></li><li class="sidebar-sub-header"><a href="/blog/ffmpeg/cmd/ffmpeg_cmd.html#视频参数" class="sidebar-link">视频参数</a></li><li class="sidebar-sub-header"><a href="/blog/ffmpeg/cmd/ffmpeg_cmd.html#音频参数" class="sidebar-link">音频参数</a></li><li class="sidebar-sub-header"><a href="/blog/ffmpeg/cmd/ffmpeg_cmd.html#_1、基本信息查询命令" class="sidebar-link">1、基本信息查询命令</a></li><li class="sidebar-sub-header"><a href="/blog/ffmpeg/cmd/ffmpeg_cmd.html#_2、裁剪和合并命令" class="sidebar-link">2、裁剪和合并命令</a></li><li class="sidebar-sub-header"><a href="/blog/ffmpeg/cmd/ffmpeg_cmd.html#_3、录制命令" class="sidebar-link">3、录制命令</a></li><li class="sidebar-sub-header"><a href="/blog/ffmpeg/cmd/ffmpeg_cmd.html#_4、图片-视频互转命令" class="sidebar-link">4、图片/视频互转命令</a></li><li class="sidebar-sub-header"><a href="/blog/ffmpeg/cmd/ffmpeg_cmd.html#_5、分解-复用命令" class="sidebar-link">5、分解/复用命令</a></li><li class="sidebar-sub-header"><a href="/blog/ffmpeg/cmd/ffmpeg_cmd.html#_6、直播命令" class="sidebar-link">6、直播命令</a></li><li class="sidebar-sub-header"><a href="/blog/ffmpeg/cmd/ffmpeg_cmd.html#_7、处理原始数据命令" class="sidebar-link">7、处理原始数据命令</a></li><li class="sidebar-sub-header"><a href="/blog/ffmpeg/cmd/ffmpeg_cmd.html#_8、滤镜命令" class="sidebar-link">8、滤镜命令</a></li></ul></li><li><a href="/blog/ffmpeg/cmd/ffplay_cmd.html" class="sidebar-link">ffplay命令</a></li><li><a href="/blog/ffmpeg/cmd/ffprobe_cmd.html" class="sidebar-link">ffprobe命令</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ffmpeg重要结构体</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>解码</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ffmpeg文件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>YUV播放器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>环境配置</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ffmpeg命令"><a href="#ffmpeg命令" class="header-anchor">#</a> ffmpeg命令</h1> <h2 id="命令基本格式及参数"><a href="#命令基本格式及参数" class="header-anchor">#</a> 命令基本格式及参数</h2> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg [options] [[infile options] -i infile]... {[outfile options] outfile}...
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>ffmpeg arg1 arg2 -i arg3 arg4 arg5
</code></pre></div><ul><li>arg1：全局参数</li> <li>arg2：输入文件参数</li> <li>arg3：输入文件</li> <li>arg4：输出文件参数</li> <li>arg5：输出文件</li></ul> <p>ffmpeg 通过 -i 选项读取输任意数量的输入“文件”（可以是常规文件，管道，网络流，抓取设备等，并写入任意数量的输出“文件”。
原则上，每个输入/输出“文件”都可以包含任意数量的不同类型的视频流（视频/音频/字幕/附件/数据）。 流的数量和/或类型是由容器格式来限制。 选择从哪个输入进入到哪个输出将自动完成或使用 -map 选项。
要引用选项中的输入文件，您必须使用它们的索引（从0开始）。 例如。 第一个输入文件是0，第二个输入文件是1，等等。类似地，文件内的流被它们的索引引用。 例如。 2：3是指第三个输入文件中的第四个流。</p> <h2 id="主要参数"><a href="#主要参数" class="header-anchor">#</a> 主要参数</h2> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td>-f fmt（输入/输出）</td> <td>强制输入或输出文件格式。 格式通常是自动检测输入文件，并从输出文件的文件扩展名中猜测出来，所以在大多数情况下这个选项是不需要的。</td></tr> <tr><td>-i url（输入）</td> <td>输入文件</td></tr> <tr><td>-y（全局参数）</td> <td>覆盖输出文件而不询问。</td></tr> <tr><td>-n（全局参数）</td> <td>不要覆盖输出文件，如果指定的输出文件已经存在，请立即退出。</td></tr> <tr><td>-c [：stream_specifier] codec（输入/输出，每个流）</td> <td>选择一个编码器（当在输出文件之前使用）或解码器（当在输入文件之前使用时）用于一个或多个流。codec 是解码器/编码器的名称或 copy（仅输出）以指示该流不被重新编码。如：ffmpeg -i INPUT -map 0 -c:v libx264 -c:a copy OUTPUT</td></tr> <tr><td>-codec [：stream_specifier]编解码器（输入/输出，每个流）</td> <td>同 -c</td></tr> <tr><td>-t duration（输入/输出）</td> <td>当用作输入选项（在-i之前）时，限制从输入文件读取的数据的持续时间。当用作输出选项时（在输出url之前），在持续时间到达持续时间之后停止输出。</td></tr> <tr><td>-ss位置（输入/输出）</td> <td>当用作输入选项时（在-i之前），在这个输入文件中寻找位置。 请注意，在大多数格式中，不可能精确搜索，因此ffmpeg将在位置之前寻找最近的搜索点。 当转码和-accurate_seek被启用时（默认），搜索点和位置之间的这个额外的分段将被解码和丢弃。 当进行流式复制或使用-noaccurate_seek时，它将被保留。当用作输出选项（在输出url之前）时，解码但丢弃输入，直到时间戳到达位置。</td></tr> <tr><td>-frames [：stream_specifier] framecount（output，per-stream）</td> <td>停止在帧计数帧之后写入流。</td></tr> <tr><td>-filter [：stream_specifier] filtergraph（output，per-stream）</td> <td>创建由filtergraph指定的过滤器图，并使用它来过滤流。filtergraph是应用于流的filtergraph的描述，并且必须具有相同类型的流的单个输入和单个输出。在过滤器图形中，输入与标签中的标签相关联，标签中的输出与标签相关联。有关filtergraph语法的更多信息，请参阅ffmpeg-filters手册。</td></tr></tbody></table> <h2 id="视频参数"><a href="#视频参数" class="header-anchor">#</a> 视频参数</h2> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td>-aspect [：stream_specifier] 宽高比（输出，每个流）</td> <td>设置方面指定的视频显示宽高比。aspect可以是浮点数字符串，也可以是num：den形式的字符串，其中num和den是宽高比的分子和分母。例如“4：3”，“16：9”，“1.3333”和“1.7777”是有效的参数值。如果与-vcodec副本一起使用，则会影响存储在容器级别的宽高比，但不会影响存储在编码帧中的宽高比（如果存在）。</td></tr> <tr><td>-vn（输出）</td> <td>禁用视频录制。</td></tr> <tr><td>-vcodec编解码器（输出）</td> <td>设置视频编解码器。这是-codec：v的别名。</td></tr> <tr><td>-vf filtergraph（输出）</td> <td>创建由filtergraph指定的过滤器图，并使用它来过滤流。</td></tr></tbody></table> <h2 id="音频参数"><a href="#音频参数" class="header-anchor">#</a> 音频参数</h2> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td>-aframes（输出）</td> <td>设置要输出的音频帧的数量。这是-frames：a的一个过时的别名。</td></tr> <tr><td>-ar [：stream_specifier] freq（输入/输出，每个流）</td> <td>设置音频采样频率。对于输出流，它默认设置为相应输入流的频率。对于输入流，此选项仅适用于音频捕获设备和原始分路器，并映射到相应的分路器选件。</td></tr> <tr><td>-ac [：stream_specifier]通道（输入/输出，每个流）</td> <td>设置音频通道的数量。对于输出流，它默认设置为输入音频通道的数量。对于输入流，此选项仅适用于音频捕获设备和原始分路器，并映射到相应的分路器选件。</td></tr> <tr><td>-an（输出）</td> <td>禁用录音。</td></tr> <tr><td>-acodec编解码器（输入/输出）</td> <td>设置音频编解码器。这是-codec的别名：a。</td></tr> <tr><td>-sample_fmt [：stream_specifier] sample_fmt（输出，每个流）</td> <td>设置音频采样格式。使用-sample_fmts获取支持的样本格式列表。</td></tr> <tr><td>-af filtergraph（输出）</td> <td>创建由filtergraph指定的过滤器图，并使用它来过滤流。</td></tr></tbody></table> <h2 id="_1、基本信息查询命令"><a href="#_1、基本信息查询命令" class="header-anchor">#</a> 1、基本信息查询命令</h2> <h4 id="查看设备"><a href="#查看设备" class="header-anchor">#</a> 查看设备</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -f avfoundation -list_devices true -i ''
</code></pre></div><h4 id="格式转变换"><a href="#格式转变换" class="header-anchor">#</a> 格式转变换</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i infile.mp4 -vcodec copy -acodec copy outfile.flv
</code></pre></div><p>ffmpeg -i out.flv -vcodec copy -acodec copy cai.mp4</p> <p>ffmpeg -i out.flv -c copy -c:s mov_text output.mp4 -y</p> <h2 id="_2、裁剪和合并命令"><a href="#_2、裁剪和合并命令" class="header-anchor">#</a> 2、裁剪和合并命令</h2> <h4 id="裁剪"><a href="#裁剪" class="header-anchor">#</a> 裁剪</h4> <ul><li>-ss 开始时间</li> <li>-t 裁剪长度</li></ul> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i in.flv -ss 00:00:00 -t 10 out.flv
</code></pre></div><h4 id="视频合并"><a href="#视频合并" class="header-anchor">#</a> 视频合并</h4> <ul><li>-f concat 对文件拼接
首先创建一个 inputs.txt 文件，文件内容如下：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>file '1.flv'
file '2.flv'
file '3.flv'
</code></pre></div><p>然后执行下面的命令：</p> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -f concat -i inputs.txt -c copy output.flv
</code></pre></div><h4 id="hls切片"><a href="#hls切片" class="header-anchor">#</a> hls切片</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i out.mp4 -c:v libx264 -c:a libfdk_aac -strict -2 -f hls  out.m3u8
</code></pre></div><ul><li>-strict -2 指明音频使有AAC。</li> <li>f hls 转成 m3u8 格式。</li></ul> <h4 id="视频裁剪"><a href="#视频裁剪" class="header-anchor">#</a> 视频裁剪</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i VR.mov  -vf crop=in_w-200:in_h-200 -c:v libx264 -c:a copy -video_size 1280x720 vr_new.mp4

</code></pre></div><p>crop 格式：crop=out_w:out_h❌y</p> <ul><li>out_w: 输出的宽度。可以使用 in_w 表式输入视频的宽度。</li> <li>out_h: 输出的高度。可以使用 in_h 表式输入视频的高度。</li> <li>x : X坐标</li> <li>y : Y坐标
如果 x和y 设置为 0,说明从左上角开始裁剪。如果不写是从中心点裁剪。
倍速播放</li></ul> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i out.mp4 -filter_complex &quot;[0:v]setpts=0.5*PTS[v];[0:a]atempo=2.0[a]&quot; -map &quot;[v]&quot; -map &quot;[a]&quot; speed2.0.mp4
</code></pre></div><ul><li>-filter_complex 复杂滤镜，[0:v]表示第一个（文件索引号是0）文件的视频作为输入。setpts=0.5*PTS表示每帧视频的pts时间戳都乘0.5 ，也就是差少一半。[v]表示输出的别名。音频同理就不详述了。</li> <li>map 可用于处理复杂输出，如可以将指定的多路流输出到一个输出文件，也可以指定输出到多个文件。&quot;[v]&quot; 复杂滤镜输出的别名作为输出文件的一路流。上面 map的用法是将复杂滤镜输出的视频和音频输出到指定文件中。</li></ul> <h4 id="对称视频"><a href="#对称视频" class="header-anchor">#</a> 对称视频</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg  -i out.mp4 -filter_complex &quot;[0:v]pad=w=2*iw[a];[0:v]hflip[b];[a][b]overlay=x=w&quot; duicheng.mp4
</code></pre></div><h4 id="hflip-水平翻转"><a href="#hflip-水平翻转" class="header-anchor">#</a> hflip 水平翻转</h4> <p>如果要修改为垂直翻转可以用vflip。</p> <h4 id="画中画"><a href="#画中画" class="header-anchor">#</a> 画中画</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i out.mp4 -i out1.mp4 -filter_complex &quot;[1:v]scale=w=176:h=144:force_original_aspect_ratio=decrease[ckout];[0:v][ckout]overlay=x=W-w-10:y=0[out]&quot; -map &quot;[out]&quot; -movflags faststart new.mp4
</code></pre></div><h4 id="录制画中画"><a href="#录制画中画" class="header-anchor">#</a> 录制画中画</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg  -f avfoundation -i &quot;1&quot; -framerate 30 -f avfoundation -i &quot;0:0&quot; 
-r 30 -c:v libx264 -preset ultrafast 
-c:a libfdk_aac -profile:a aac_he_v2 -ar 44100 -ac 2 
-filter_complex &quot;[1:v]scale=w=176:h=144:force_original_aspect_ratio=decrease[a];[0:v][a]overlay=x=W-w-10:y=0[out]&quot; 
-map &quot;[out]&quot; -movflags faststart -map 1:a b.mp4
</code></pre></div><h4 id="多路视频拼接"><a href="#多路视频拼接" class="header-anchor">#</a> 多路视频拼接</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg  -f avfoundation -i &quot;1&quot; -framerate 30 -f avfoundation   -i &quot;0:0&quot; -r 30 -c:v libx264 -preset ultrafast -c:a libfdk_aac -profile:a aac_he_v2 -ar 44100 -ac 2 -filter_complex &quot;[0:v]scale=320:240[a];[a]pad=640:240[b];[b][1:v]overlay=320:0[out]&quot; -map &quot;[out]&quot; -movflags faststart  -map 1:a  c.mp4
</code></pre></div><h2 id="_3、录制命令"><a href="#_3、录制命令" class="header-anchor">#</a> 3、录制命令</h2> <h4 id="mac-ios设备查询"><a href="#mac-ios设备查询" class="header-anchor">#</a> Mac&amp;iOS设备查询</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -f avfoundation -list_devices true -i &quot;&quot;
</code></pre></div><h4 id="录屏"><a href="#录屏" class="header-anchor">#</a> 录屏</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -f avfoundation -i 1 -r 30 out.yuv
</code></pre></div><ul><li>-f 指定使用 avfoundation 采集数据。</li> <li>-i 指定从哪儿采集数据，它是一个文件索引号。在我的MAC上，1代表桌面（可以通过上面的命令查询设备索引号）。</li> <li>-r 指定帧率。按ffmpeg官方文档说-r与-framerate作用相同，但实际测试时发现不同。- - -framerate 用于限制输入，而-r用于限制输出。</li></ul> <h4 id="录屏-声音"><a href="#录屏-声音" class="header-anchor">#</a> 录屏+声音</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg  -f avfoundation -i 1:0  -r 29.97 -c:v libx264 -crf 0 -c:a libfdk_aac -profile:a aac_he_v2 -b:a 32k  out.flv
</code></pre></div><ul><li>-i 1:0 冒号前面的 &quot;1&quot; 代表的屏幕索引号。冒号后面的&quot;0&quot;代表的声音索相号。</li> <li>-c:v 与参数 -vcodec 一样，表示视频编码器。c 是 codec 的缩写，v 是video的缩写。</li> <li>-crf 是 x264 的参数。 0 表式无损压缩。</li> <li>-c:a 与参数 -acodec 一样，表示音频编码器。</li> <li>-profile 是 fdk_aac 的参数。 aac_he_v2 表式使用 AAC_HE v2 压缩数据。</li> <li>-b:a 指定音频码率。 b 是 bitrate的缩写, a是 audio的缩与。</li></ul> <h4 id="录视频"><a href="#录视频" class="header-anchor">#</a> 录视频</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -framerate 30 -f avfoundation -i 0 out.mp4 
</code></pre></div><ul><li>-framerate 限制视频的采集帧率。这个必须要根据提示要求进行设置，如果不设置就会报错。</li> <li>-f 指定使用 avfoundation 采集数据。</li> <li>-i 指定视频设备的索引号。</li></ul> <h4 id="视频-音频"><a href="#视频-音频" class="header-anchor">#</a> 视频+音频</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -framerate 30 -f avfoundation -i 0:0 out.mp4 
</code></pre></div><h4 id="录音"><a href="#录音" class="header-anchor">#</a> 录音</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -f avfoundation -i :0 out.wav
</code></pre></div><h4 id="录制音频裸数据"><a href="#录制音频裸数据" class="header-anchor">#</a> 录制音频裸数据</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg  -f avfoundation -i :0 -ar 44100 -f s16le out.pcm
</code></pre></div><h2 id="_4、图片-视频互转命令"><a href="#_4、图片-视频互转命令" class="header-anchor">#</a> 4、图片/视频互转命令</h2> <h4 id="jpg转yuv"><a href="#jpg转yuv" class="header-anchor">#</a> jpg转yuv</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i a.yuv -pixel_format yuv420p b.yuv

</code></pre></div><h4 id="jpg转yuv-2"><a href="#jpg转yuv-2" class="header-anchor">#</a> jpg转yuv</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg  -s 1920x1080 -pix_fmt nv21 -i a.yuv image.jpg
</code></pre></div><h4 id="视频转jpeg"><a href="#视频转jpeg" class="header-anchor">#</a> 视频转JPEG</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i test.flv -r 1 -f image2 image-%3d.jpeg
</code></pre></div><h4 id="视频转gif"><a href="#视频转gif" class="header-anchor">#</a> 视频转gif</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i out.mp4 -ss 00:00:00 -t 10 out.gif
</code></pre></div><h4 id="图片转视频"><a href="#图片转视频" class="header-anchor">#</a> 图片转视频</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg  -f image2 -i image-%3d.jpeg images.mp4
</code></pre></div><h2 id="_5、分解-复用命令"><a href="#_5、分解-复用命令" class="header-anchor">#</a> 5、分解/复用命令</h2> <p>流拷贝是通过将 copy 参数提供给-codec选项来选择流的模式。它使得ffmpeg省略了指定流的解码和编码步骤，所以它只能进行多路分解和多路复用。 这对于更改容器格式或修改容器级元数据很有用。 由于没有解码或编码，速度非常快，没有质量损失。 但是，由于许多因素，在某些情况下可能无法正常工作。 应用过滤器显然也是不可能的，因为过滤器处理未压缩的数据</p> <h4 id="抽取音频流"><a href="#抽取音频流" class="header-anchor">#</a> 抽取音频流</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i input.mp4 -acodec copy -vn out.aac
</code></pre></div><ul><li>-acodec: 指定音频编码器，copy 指明只拷贝，不做编解码。</li> <li>-vn: v 代表视频，n 代表 no 也就是无视频的意思。</li></ul> <h4 id="抽取视频流"><a href="#抽取视频流" class="header-anchor">#</a> 抽取视频流</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i input.mp4 -vcodec copy -an out.h264
</code></pre></div><ul><li>-vcodec: 指定视频编码器，copy 指明只拷贝，不做编解码。</li> <li>-an: a 代表音频，n 代表 no 也就是无音频的意思。</li></ul> <h4 id="转格式"><a href="#转格式" class="header-anchor">#</a> 转格式</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i out.mp4 -vcodec copy -acodec copy out.flv
</code></pre></div><p>上面的命令表式的是音频、视频都直接 copy，只是将 mp4 的封装格式转成了flv。</p> <h4 id="音视频合并"><a href="#音视频合并" class="header-anchor">#</a> 音视频合并</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i out.h264 -i out.aac -vcodec copy -acodec copy out.mp4
</code></pre></div><h2 id="_6、直播命令"><a href="#_6、直播命令" class="header-anchor">#</a> 6、直播命令</h2> <h4 id="mac-nginx启动"><a href="#mac-nginx启动" class="header-anchor">#</a> mac nginx启动</h4> <div class="language- extra-class"><pre class="language-text"><code>nginx -s reload
</code></pre></div><h4 id="推流"><a href="#推流" class="header-anchor">#</a> 推流</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -re -i out.mp4 -c copy -f flv rtmp://server/live/streamName
</code></pre></div><h4 id="拉流保存"><a href="#拉流保存" class="header-anchor">#</a> 拉流保存</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i rtmp://server/live/streamName -c copy dump.flv
</code></pre></div><h4 id="转流"><a href="#转流" class="header-anchor">#</a> 转流</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i rtmp://server/live/originalStream -c:a copy -c:v copy -f flv rtmp://server/live/h264Stream
</code></pre></div><h4 id="实时推流"><a href="#实时推流" class="header-anchor">#</a> 实时推流</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -framerate 15 -f avfoundation -i &quot;1&quot; -s 1280x720 -c:v libx264 -f flv rtmp://localhost:1935/live/room

ffmpeg -framerate 15 -f avfoundation -i &quot;1&quot; -s 640x480 -c:v libx264 -f flv rtmp://192.168.1.2:1935/live/room



</code></pre></div><p>ffmpeg -framerate 15 -f avfoundation -i &quot;1&quot; -s 1280x720 -c:v libx264 -f flv rtmp://10.50.128.18:1935/live/room</p> <p>ffmpeg -re -i a.flv -c copy -f flv rtmp://10.50.128.18:1935/live/room</p> <h2 id="_7、处理原始数据命令"><a href="#_7、处理原始数据命令" class="header-anchor">#</a> 7、处理原始数据命令</h2> <p>ffmpeg -i  -an -c:v rawvideo -pixel_format yuv420p out.yuv</p> <h4 id="提取原始yuv"><a href="#提取原始yuv" class="header-anchor">#</a> 提取原始YUV</h4> <div class="language-sh extra-class"><pre class="language-sh"><code>ffmpeg -i input.mp4 -an -c:v rawvideo -pixel_format yuv420p out.yuv

ffmpeg -c:v h264 -i in.h264 out.yuv

ffplay -s wxh out.yuv
</code></pre></div><p>-c:v rawvideo 指定将视频转成原始数据
-pixel_format yuv420p 指定转换格式为yuv420p</p> <h4 id="yuv转h264"><a href="#yuv转h264" class="header-anchor">#</a> YUV转H264</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -f rawvideo -pix_fmt yuv420p -s 320x240 -r 30 -i out.yuv -c:v libx264 -f rawvideo out.h264



ffmpeg -s 640x480 -pix_fmt yuv420p -i in.yuv -c:v libx264 out.h264

</code></pre></div><h4 id="提取原始pcm"><a href="#提取原始pcm" class="header-anchor">#</a> 提取原始PCM</h4> <div class="language-sh extra-class"><pre class="language-sh"><code>ffmpeg -i out.mp4 -vn -ar <span class="token number">44100</span> -ac <span class="token number">2</span> -f s16le out.pcm

ffplay -ar <span class="token number">44100</span> -ac <span class="token number">2</span> -f s16le -i out.pcm
</code></pre></div><h4 id="pcm转wav"><a href="#pcm转wav" class="header-anchor">#</a> PCM转WAV</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -f s16be -ar 8000 -ac 2 -acodec pcm_s16be -i input.raw output.wav
</code></pre></div><h2 id="_8、滤镜命令"><a href="#_8、滤镜命令" class="header-anchor">#</a> 8、滤镜命令</h2> <h4 id="简单滤镜"><a href="#简单滤镜" class="header-anchor">#</a> 简单滤镜</h4> <p>简单的过滤器图是那些只有一个输入和输出，都是相同的类型。 在上面的图中，它们可以通过在解码和编码之间插入一个额外的步骤来表示：
简单的filtergraphs配置了per-stream-filter选项（分别为视频和音频使用-vf和-af别名）。 一个简单的视频filtergraph可以看起来像这样的例子：
请注意，某些滤镜会更改帧属性，但不会改变帧内容。 例如。 上例中的fps过滤器会改变帧数，但不会触及帧内容。 另一个例子是setpts过滤器，它只设置时间戳，否则不改变帧。</p> <h4 id="复杂滤镜"><a href="#复杂滤镜" class="header-anchor">#</a> 复杂滤镜</h4> <p>复杂的过滤器图是那些不能简单描述为应用于一个流的线性处理链的过滤器图。 例如，当图形有多个输入和/或输出，或者当输出流类型与输入不同时，就是这种情况。 他们可以用下图来表示：</p> <p>复杂的过滤器图使用-filter_complex选项进行配置。 请注意，此选项是全局性的，因为复杂的过滤器图形本质上不能与单个流或文件明确关联。
-lavfi选项等同于-filter_complex。
一个复杂的过滤器图的一个简单的例子是覆盖过滤器，它有两个视频输入和一个视频输出，包含一个视频叠加在另一个上面。 它的音频对应是amix滤波器。</p> <h4 id="添加水印"><a href="#添加水印" class="header-anchor">#</a> 添加水印</h4> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i out.mp4  -vf &quot;movie=logo.png,scale=64:48[watermask];[in][watermask] overlay=30:10 [out]&quot; water.mp4
</code></pre></div><ul><li>-vf中的 movie 指定logo位置。scale 指定 logo 大小。overlay 指定 logo 摆放的位置</li></ul> <h4 id="删除水印"><a href="#删除水印" class="header-anchor">#</a> 删除水印</h4> <p>删除水印先通过 ffplay 找到要删除 LOGO 的位置</p> <div class="language- extra-class"><pre class="language-text"><code>ffplay -i test.flv -vf delogo=x=806:y=20:w=70:h=80:show=1
</code></pre></div><p>使用 delogo 滤镜删除 LOGO</p> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i test.flv -vf delogo=x=806:y=20:w=70:h=80 output.flv
</code></pre></div><p>视频缩小一倍</p> <div class="language- extra-class"><pre class="language-text"><code>ffmpeg -i out.mp4 -vf scale=iw/2:-1 scale.mp4
</code></pre></div><ul><li>-vf scale 指定使用简单过滤器 scale，iw/2:-1 中的 iw 指定按整型取视频的宽度。 -1 表示高度随宽度一起变化。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/ffmpeg/class.html" class="prev">
        重要的类
      </a></span> <span class="next"><a href="/blog/ffmpeg/cmd/ffplay_cmd.html">
        ffplay命令
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.2b1dd648.js" defer></script><script src="/blog/assets/js/2.9d35f1e7.js" defer></script><script src="/blog/assets/js/25.c7b87c99.js" defer></script>
  </body>
</html>
